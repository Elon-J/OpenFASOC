##for HSPICE netlist
import re
import function
import os
import sys
import math

import numpy as np
from scipy import interpolate

def gen_dcdc_netlist(cells, args, jsonSpec, platformConfig, srcDir):
    
    # power mux models
    xs = list(range(100, 10001, 100))
    ys = [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8]
    zz = np.array([2.724E-12, 4.749E-04, 8.991E-04, 1.267E-03, 1.570E-03, 1.788E-03, 1.911E-03, 1.980E-03, 2.029E-03, 2.075E-03, 2.136E-03, 2.216E-03, 2.313E-03, 2.426E-03, 2.553E-03, 2.690E-03, 2.836E-03, 2.990E-03, 3.149E-03, 1.818E-12, 3.223E-04, 6.211E-04, 8.915E-04, 1.128E-03, 1.322E-03, 1.458E-03, 1.534E-03, 1.580E-03, 1.617E-03, 1.663E-03, 1.724E-03, 1.798E-03, 1.884E-03, 1.980E-03, 2.084E-03, 2.196E-03, 2.313E-03, 2.435E-03, 1.364E-12, 2.439E-04, 4.742E-04, 6.874E-04, 8.790E-04, 1.043E-03, 1.172E-03, 1.253E-03, 1.297E-03, 1.330E-03, 1.367E-03, 1.416E-03, 1.476E-03, 1.545E-03, 1.623E-03, 1.708E-03, 1.799E-03, 1.895E-03, 1.995E-03, 1.091E-12, 1.961E-04, 3.834E-04, 5.593E-04, 7.202E-04, 8.615E-04, 9.772E-04, 1.058E-03, 1.102E-03, 1.132E-03, 1.163E-03, 1.204E-03, 1.255E-03, 1.313E-03, 1.380E-03, 1.452E-03, 1.530E-03, 1.612E-03, 1.698E-03, 9.098E-13, 1.640E-04, 3.218E-04, 4.714E-04, 6.100E-04, 7.339E-04, 8.379E-04, 9.148E-04, 9.593E-04, 9.863E-04, 1.014E-03, 1.049E-03, 1.093E-03, 1.144E-03, 1.202E-03, 1.266E-03, 1.334E-03, 1.407E-03, 1.484E-03, 7.799E-13, 1.409E-04, 2.772E-04, 4.074E-04, 5.291E-04, 6.393E-04, 7.335E-04, 8.057E-04, 8.497E-04, 8.751E-04, 8.996E-04, 9.309E-04, 9.697E-04, 1.015E-03, 1.067E-03, 1.124E-03, 1.186E-03, 1.252E-03, 1.324E-03, 6.825E-13, 1.235E-04, 2.435E-04, 3.587E-04, 4.672E-04, 5.664E-04, 6.524E-04, 7.200E-04, 7.629E-04, 7.870E-04, 8.092E-04, 8.373E-04, 8.722E-04, 9.134E-04, 9.602E-04, 1.012E-03, 1.070E-03, 1.132E-03, 1.202E-03, 6.067E-13, 1.099E-04, 2.171E-04, 3.204E-04, 4.183E-04, 5.085E-04, 5.875E-04, 6.508E-04, 6.925E-04, 7.156E-04, 7.359E-04, 7.614E-04, 7.932E-04, 8.309E-04, 8.741E-04, 9.224E-04, 9.764E-04, 1.037E-03, 1.108E-03, 5.461E-13, 9.903E-05, 1.958E-04, 2.895E-04, 3.786E-04, 4.613E-04, 5.345E-04, 5.939E-04, 6.341E-04, 6.563E-04, 6.751E-04, 6.985E-04, 7.278E-04, 7.627E-04, 8.029E-04, 8.485E-04, 9.003E-04, 9.607E-04, 1.036E-03, 4.965E-13, 9.011E-05, 1.784E-04, 2.640E-04, 3.459E-04, 4.222E-04, 4.903E-04, 5.462E-04, 5.850E-04, 6.064E-04, 6.239E-04, 6.456E-04, 6.728E-04, 7.054E-04, 7.432E-04, 7.867E-04, 8.372E-04, 8.990E-04, 9.813E-04, 4.551E-13, 8.266E-05, 1.638E-04, 2.426E-04, 3.183E-04, 3.892E-04, 4.529E-04, 5.057E-04, 5.430E-04, 5.637E-04, 5.802E-04, 6.004E-04, 6.258E-04, 6.565E-04, 6.924E-04, 7.343E-04, 7.845E-04, 8.493E-04, 9.400E-04, 4.201E-13, 7.635E-05, 1.514E-04, 2.245E-04, 2.948E-04, 3.610E-04, 4.208E-04, 4.709E-04, 5.067E-04, 5.268E-04, 5.423E-04, 5.613E-04, 5.852E-04, 6.143E-04, 6.486E-04, 6.894E-04, 7.401E-04, 8.103E-04, 9.065E-04, 3.901E-13, 7.094E-05, 1.407E-04, 2.089E-04, 2.746E-04, 3.366E-04, 3.930E-04, 4.406E-04, 4.751E-04, 4.946E-04, 5.093E-04, 5.271E-04, 5.498E-04, 5.775E-04, 6.105E-04, 6.507E-04, 7.026E-04, 7.785E-04, 8.751E-04, 3.641E-13, 6.624E-05, 1.315E-04, 1.953E-04, 2.569E-04, 3.154E-04, 3.687E-04, 4.140E-04, 4.472E-04, 4.662E-04, 4.801E-04, 4.970E-04, 5.186E-04, 5.451E-04, 5.771E-04, 6.169E-04, 6.716E-04, 7.509E-04, 8.442E-04, 3.414E-13, 6.212E-05, 1.234E-04, 1.833E-04, 2.414E-04, 2.966E-04, 3.472E-04, 3.905E-04, 4.225E-04, 4.409E-04, 4.542E-04, 4.703E-04, 4.909E-04, 5.164E-04, 5.476E-04, 5.874E-04, 6.450E-04, 7.273E-04, 8.140E-04, 3.213E-13, 5.849E-05, 1.162E-04, 1.728E-04, 2.277E-04, 2.800E-04, 3.281E-04, 3.695E-04, 4.004E-04, 4.183E-04, 4.311E-04, 4.464E-04, 4.661E-04, 4.907E-04, 5.213E-04, 5.615E-04, 6.224E-04, 7.047E-04, 7.850E-04, 3.035E-13, 5.526E-05, 1.098E-04, 1.634E-04, 2.154E-04, 2.651E-04, 3.110E-04, 3.507E-04, 3.805E-04, 3.980E-04, 4.102E-04, 4.249E-04, 4.439E-04, 4.677E-04, 4.978E-04, 5.392E-04, 6.027E-04, 6.825E-04, 7.572E-04, 2.875E-13, 5.236E-05, 1.041E-04, 1.549E-04, 2.044E-04, 2.517E-04, 2.956E-04, 3.337E-04, 3.626E-04, 3.796E-04, 3.914E-04, 4.055E-04, 4.237E-04, 4.469E-04, 4.767E-04, 5.192E-04, 5.850E-04, 6.608E-04, 7.307E-04, 2.731E-13, 4.976E-05, 9.895E-05, 1.473E-04, 1.945E-04, 2.396E-04, 2.816E-04, 3.183E-04, 3.463E-04, 3.628E-04, 3.742E-04, 3.878E-04, 4.054E-04, 4.280E-04, 4.576E-04, 5.015E-04, 5.682E-04, 6.400E-04, 7.056E-04, 2.601E-13, 4.740E-05, 9.429E-05, 1.404E-04, 1.854E-04, 2.287E-04, 2.690E-04, 3.043E-04, 3.314E-04, 3.476E-04, 3.586E-04, 3.716E-04, 3.887E-04, 4.108E-04, 4.403E-04, 4.858E-04, 5.529E-04, 6.201E-04, 6.817E-04, 2.483E-13, 4.526E-05, 9.004E-05, 1.341E-04, 1.772E-04, 2.187E-04, 2.574E-04, 2.915E-04, 3.178E-04, 3.335E-04, 3.442E-04, 3.568E-04, 3.734E-04, 3.950E-04, 4.245E-04, 4.717E-04, 5.379E-04, 6.010E-04, 6.591E-04, 2.375E-13, 4.330E-05, 8.616E-05, 1.284E-04, 1.697E-04, 2.095E-04, 2.468E-04, 2.797E-04, 3.052E-04, 3.206E-04, 3.310E-04, 3.432E-04, 3.593E-04, 3.806E-04, 4.106E-04, 4.589E-04, 5.233E-04, 5.828E-04, 6.377E-04, 2.276E-13, 4.150E-05, 8.260E-05, 1.231E-04, 1.628E-04, 2.010E-04, 2.370E-04, 2.688E-04, 2.937E-04, 3.087E-04, 3.187E-04, 3.306E-04, 3.463E-04, 3.672E-04, 3.976E-04, 4.472E-04, 5.091E-04, 5.655E-04, 6.175E-04, 2.185E-13, 3.985E-05, 7.933E-05, 1.183E-04, 1.564E-04, 1.933E-04, 2.279E-04, 2.588E-04, 2.830E-04, 2.980E-04, 3.074E-04, 3.189E-04, 3.343E-04, 3.549E-04, 3.857E-04, 4.362E-04, 4.954E-04, 5.489E-04, 5.984E-04, 2.101E-13, 3.832E-05, 7.630E-05, 1.138E-04, 1.505E-04, 1.861E-04, 2.196E-04, 2.495E-04, 2.730E-04, 2.877E-04, 2.969E-04, 3.081E-04, 3.231E-04, 3.435E-04, 3.747E-04, 4.258E-04, 4.822E-04, 5.332E-04, 5.803E-04, 2.023E-13, 3.691E-05, 7.350E-05, 1.096E-04, 1.451E-04, 1.794E-04, 2.118E-04, 2.408E-04, 2.637E-04, 2.782E-04, 2.871E-04, 2.980E-04, 3.127E-04, 3.329E-04, 3.647E-04, 4.156E-04, 4.696E-04, 5.182E-04, 5.632E-04, 1.951E-13, 3.559E-05, 7.089E-05, 1.058E-04, 1.400E-04, 1.732E-04, 2.046E-04, 2.327E-04, 2.551E-04, 2.692E-04, 2.779E-04, 2.885E-04, 3.029E-04, 3.230E-04, 3.554E-04, 4.064E-04, 4.576E-04, 5.039E-04, 5.470E-04, 1.884E-13, 3.437E-05, 6.847E-05, 1.022E-04, 1.353E-04, 1.674E-04, 1.978E-04, 2.252E-04, 2.470E-04, 2.609E-04, 2.693E-04, 2.797E-04, 2.938E-04, 3.138E-04, 3.468E-04, 3.973E-04, 4.460E-04, 4.903E-04, 5.316E-04, 1.821E-13, 3.323E-05, 6.620E-05, 9.880E-05, 1.308E-04, 1.619E-04, 1.915E-04, 2.181E-04, 2.394E-04, 2.530E-04, 2.613E-04, 2.714E-04, 2.853E-04, 3.055E-04, 3.388E-04, 3.881E-04, 4.349E-04, 4.773E-04, 5.170E-04, 1.762E-13, 3.216E-05, 6.408E-05, 9.565E-05, 1.267E-04, 1.569E-04, 1.855E-04, 2.115E-04, 2.323E-04, 2.457E-04, 2.537E-04, 2.636E-04, 2.773E-04, 2.974E-04, 3.313E-04, 3.795E-04, 4.243E-04, 4.650E-04, 5.031E-04, 1.707E-13, 3.116E-05, 6.209E-05, 9.270E-05, 1.228E-04, 1.521E-04, 1.800E-04, 2.052E-04, 2.256E-04, 2.387E-04, 2.466E-04, 2.563E-04, 2.697E-04, 2.899E-04, 3.242E-04, 3.712E-04, 4.141E-04, 4.532E-04, 4.899E-04, 1.656E-13, 3.021E-05, 6.022E-05, 8.992E-05, 1.191E-04, 1.476E-04, 1.747E-04, 1.993E-04, 2.193E-04, 2.322E-04, 2.398E-04, 2.494E-04, 2.626E-04, 2.827E-04, 3.176E-04, 3.635E-04, 4.044E-04, 4.420E-04, 4.774E-04, 1.607E-13, 2.933E-05, 5.846E-05, 8.730E-05, 1.157E-04, 1.434E-04, 1.697E-04, 1.938E-04, 2.133E-04, 2.260E-04, 2.335E-04, 2.428E-04, 2.559E-04, 2.761E-04, 3.113E-04, 3.556E-04, 3.950E-04, 4.312E-04, 4.655E-04, 1.561E-13, 2.849E-05, 5.680E-05, 8.483E-05, 1.124E-04, 1.394E-04, 1.651E-04, 1.885E-04, 2.076E-04, 2.201E-04, 2.274E-04, 2.366E-04, 2.495E-04, 2.698E-04, 3.052E-04, 3.481E-04, 3.861E-04, 4.210E-04, 4.541E-04, 1.518E-13, 2.770E-05, 5.523E-05, 8.250E-05, 1.094E-04, 1.356E-04, 1.606E-04, 1.835E-04, 2.023E-04, 2.145E-04, 2.217E-04, 2.308E-04, 2.435E-04, 2.638E-04, 2.994E-04, 3.408E-04, 3.774E-04, 4.112E-04, 4.432E-04, 1.477E-13, 2.696E-05, 5.375E-05, 8.029E-05, 1.065E-04, 1.320E-04, 1.564E-04, 1.788E-04, 1.972E-04, 2.092E-04, 2.163E-04, 2.252E-04, 2.378E-04, 2.582E-04, 2.938E-04, 3.338E-04, 3.692E-04, 4.018E-04, 4.328E-04, 1.438E-13, 2.625E-05, 5.234E-05, 7.820E-05, 1.037E-04, 1.286E-04, 1.525E-04, 1.743E-04, 1.923E-04, 2.042E-04, 2.112E-04, 2.199E-04, 2.323E-04, 2.528E-04, 2.885E-04, 3.270E-04, 3.612E-04, 3.928E-04, 4.229E-04, 1.401E-13, 2.558E-05, 5.101E-05, 7.621E-05, 1.011E-04, 1.254E-04, 1.487E-04, 1.701E-04, 1.877E-04, 1.994E-04, 2.065E-04, 2.149E-04, 2.271E-04, 2.478E-04, 2.830E-04, 3.205E-04, 3.536E-04, 3.842E-04, 4.134E-04, 1.366E-13, 2.494E-05, 4.974E-05, 7.432E-05, 9.858E-05, 1.223E-04, 1.451E-04, 1.660E-04, 1.834E-04, 1.949E-04, 2.018E-04, 2.100E-04, 2.222E-04, 2.430E-04, 2.782E-04, 3.142E-04, 3.463E-04, 3.760E-04, 4.044E-04, 1.333E-13, 2.433E-05, 4.853E-05, 7.253E-05, 9.621E-05, 1.194E-04, 1.416E-04, 1.622E-04, 1.792E-04, 1.905E-04, 1.973E-04, 2.055E-04, 2.175E-04, 2.384E-04, 2.734E-04, 3.081E-04, 3.392E-04, 3.681E-04, 3.957E-04, 1.301E-13, 2.376E-05, 4.738E-05, 7.081E-05, 9.395E-05, 1.166E-04, 1.384E-04, 1.585E-04, 1.752E-04, 1.864E-04, 1.931E-04, 2.011E-04, 2.133E-04, 2.341E-04, 2.688E-04, 3.023E-04, 3.324E-04, 3.605E-04, 3.873E-04, 1.271E-13, 2.320E-05, 4.628E-05, 6.918E-05, 9.180E-05, 1.139E-04, 1.353E-04, 1.550E-04, 1.714E-04, 1.824E-04, 1.890E-04, 1.969E-04, 2.090E-04, 2.299E-04, 2.640E-04, 2.966E-04, 3.259E-04, 3.532E-04, 3.793E-04, 1.242E-13, 2.268E-05, 4.524E-05, 6.762E-05, 8.974E-05, 1.114E-04, 1.323E-04, 1.516E-04, 1.677E-04, 1.786E-04, 1.851E-04, 1.929E-04, 2.049E-04, 2.260E-04, 2.595E-04, 2.912E-04, 3.196E-04, 3.461E-04, 3.716E-04, 1.214E-13, 2.217E-05, 4.424E-05, 6.613E-05, 8.777E-05, 1.090E-04, 1.294E-04, 1.484E-04, 1.642E-04, 1.749E-04, 1.813E-04, 1.890E-04, 2.010E-04, 2.222E-04, 2.552E-04, 2.859E-04, 3.135E-04, 3.394E-04, 3.642E-04, 1.188E-13, 2.169E-05, 4.328E-05, 6.471E-05, 8.588E-05, 1.066E-04, 1.267E-04, 1.453E-04, 1.609E-04, 1.714E-04, 1.777E-04, 1.853E-04, 1.972E-04, 2.186E-04, 2.509E-04, 2.808E-04, 3.077E-04, 3.329E-04, 3.571E-04, 1.162E-13, 2.123E-05, 4.236E-05, 6.334E-05, 8.408E-05, 1.044E-04, 1.241E-04, 1.423E-04, 1.577E-04, 1.681E-04, 1.743E-04, 1.818E-04, 1.936E-04, 2.151E-04, 2.469E-04, 2.759E-04, 3.020E-04, 3.266E-04, 3.503E-04, 1.138E-13, 2.079E-05, 4.148E-05, 6.203E-05, 8.235E-05, 1.023E-04, 1.215E-04, 1.395E-04, 1.546E-04, 1.648E-04, 1.710E-04, 1.784E-04, 1.901E-04, 2.117E-04, 2.429E-04, 2.711E-04, 2.966E-04, 3.206E-04, 3.437E-04, 1.115E-13, 2.037E-05, 4.064E-05, 6.077E-05, 8.069E-05, 1.002E-04, 1.191E-04, 1.367E-04, 1.516E-04, 1.617E-04, 1.678E-04, 1.751E-04, 1.868E-04, 2.085E-04, 2.390E-04, 2.665E-04, 2.913E-04, 3.148E-04, 3.373E-04, 1.093E-13, 1.996E-05, 3.983E-05, 5.957E-05, 7.909E-05, 9.826E-05, 1.168E-04, 1.341E-04, 1.487E-04, 1.588E-04, 1.647E-04, 1.720E-04, 1.836E-04, 2.054E-04, 2.352E-04, 2.620E-04, 2.862E-04, 3.091E-04, 3.312E-04, 1.071E-13, 1.957E-05, 3.905E-05, 5.841E-05, 7.756E-05, 9.637E-05, 1.146E-04, 1.316E-04, 1.460E-04, 1.559E-04, 1.618E-04, 1.689E-04, 1.806E-04, 2.023E-04, 2.316E-04, 2.576E-04, 2.813E-04, 3.037E-04, 3.253E-04, 1.051E-13, 1.920E-05, 3.831E-05, 5.729E-05, 7.608E-05, 9.455E-05, 1.124E-04, 1.291E-04, 1.433E-04, 1.531E-04, 1.589E-04, 1.660E-04, 1.776E-04, 1.994E-04, 2.280E-04, 2.534E-04, 2.766E-04, 2.985E-04, 3.196E-04, 1.031E-13, 1.883E-05, 3.759E-05, 5.622E-05, 7.466E-05, 9.279E-05, 1.104E-04, 1.268E-04, 1.408E-04, 1.504E-04, 1.562E-04, 1.632E-04, 1.748E-04, 1.966E-04, 2.248E-04, 2.494E-04, 2.719E-04, 2.934E-04, 3.141E-04, 1.012E-13, 1.849E-05, 3.689E-05, 5.518E-05, 7.329E-05, 9.110E-05, 1.084E-04, 1.245E-04, 1.383E-04, 1.479E-04, 1.536E-04, 1.605E-04, 1.720E-04, 1.939E-04, 2.214E-04, 2.454E-04, 2.675E-04, 2.885E-04, 3.088E-04, 9.934E-14, 1.815E-05, 3.622E-05, 5.419E-05, 7.197E-05, 8.947E-05, 1.064E-04, 1.223E-04, 1.359E-04, 1.454E-04, 1.510E-04, 1.578E-04, 1.694E-04, 1.912E-04, 2.181E-04, 2.416E-04, 2.632E-04, 2.837E-04, 3.036E-04, 9.757E-14, 1.783E-05, 3.558E-05, 5.323E-05, 7.070E-05, 8.790E-05, 1.046E-04, 1.202E-04, 1.336E-04, 1.430E-04, 1.485E-04, 1.553E-04, 1.668E-04, 1.886E-04, 2.149E-04, 2.379E-04, 2.590E-04, 2.791E-04, 2.986E-04, 9.585E-14, 1.751E-05, 3.496E-05, 5.230E-05, 6.947E-05, 8.638E-05, 1.028E-04, 1.182E-04, 1.314E-04, 1.406E-04, 1.461E-04, 1.529E-04, 1.643E-04, 1.861E-04, 2.118E-04, 2.342E-04, 2.549E-04, 2.747E-04, 2.938E-04, 9.420E-14, 1.721E-05, 3.436E-05, 5.140E-05, 6.829E-05, 8.491E-05, 1.011E-04, 1.162E-04, 1.293E-04, 1.384E-04, 1.438E-04, 1.505E-04, 1.619E-04, 1.836E-04, 2.087E-04, 2.307E-04, 2.510E-04, 2.704E-04, 2.891E-04, 9.261E-14, 1.692E-05, 3.378E-05, 5.054E-05, 6.714E-05, 8.349E-05, 9.938E-05, 1.143E-04, 1.272E-04, 1.362E-04, 1.416E-04, 1.482E-04, 1.596E-04, 1.812E-04, 2.058E-04, 2.273E-04, 2.472E-04, 2.662E-04, 2.846E-04, 9.106E-14, 1.664E-05, 3.322E-05, 4.970E-05, 6.603E-05, 8.212E-05, 9.776E-05, 1.125E-04, 1.252E-04, 1.341E-04, 1.394E-04, 1.460E-04, 1.574E-04, 1.789E-04, 2.029E-04, 2.240E-04, 2.435E-04, 2.621E-04, 2.802E-04, 8.957E-14, 1.637E-05, 3.267E-05, 4.889E-05, 6.496E-05, 8.079E-05, 9.619E-05, 1.107E-04, 1.232E-04, 1.321E-04, 1.373E-04, 1.438E-04, 1.552E-04, 1.766E-04, 2.001E-04, 2.208E-04, 2.399E-04, 2.582E-04, 2.760E-04, 8.812E-14, 1.610E-05, 3.215E-05, 4.810E-05, 6.392E-05, 7.951E-05, 9.467E-05, 1.090E-04, 1.213E-04, 1.301E-04, 1.353E-04, 1.417E-04, 1.531E-04, 1.744E-04, 1.974E-04, 2.176E-04, 2.364E-04, 2.544E-04, 2.718E-04, 8.673E-14, 1.585E-05, 3.164E-05, 4.735E-05, 6.292E-05, 7.826E-05, 9.320E-05, 1.073E-04, 1.195E-04, 1.282E-04, 1.333E-04, 1.397E-04, 1.511E-04, 1.722E-04, 1.947E-04, 2.146E-04, 2.330E-04, 2.507E-04, 2.678E-04, 8.537E-14, 1.560E-05, 3.115E-05, 4.661E-05, 6.194E-05, 7.706E-05, 9.177E-05, 1.057E-04, 1.177E-04, 1.263E-04, 1.314E-04, 1.377E-04, 1.491E-04, 1.701E-04, 1.921E-04, 2.116E-04, 2.297E-04, 2.471E-04, 2.639E-04, 8.406E-14, 1.536E-05, 3.067E-05, 4.590E-05, 6.100E-05, 7.589E-05, 9.039E-05, 1.041E-04, 1.160E-04, 1.245E-04, 1.296E-04, 1.358E-04, 1.472E-04, 1.680E-04, 1.896E-04, 2.087E-04, 2.265E-04, 2.435E-04, 2.601E-04, 8.278E-14, 1.513E-05, 3.021E-05, 4.521E-05, 6.008E-05, 7.475E-05, 8.905E-05, 1.026E-04, 1.143E-04, 1.227E-04, 1.278E-04, 1.340E-04, 1.453E-04, 1.660E-04, 1.872E-04, 2.059E-04, 2.234E-04, 2.401E-04, 2.564E-04, 8.155E-14, 1.490E-05, 2.976E-05, 4.453E-05, 5.919E-05, 7.365E-05, 8.774E-05, 1.011E-04, 1.127E-04, 1.210E-04, 1.260E-04, 1.322E-04, 1.435E-04, 1.641E-04, 1.848E-04, 2.032E-04, 2.203E-04, 2.368E-04, 2.529E-04, 8.035E-14, 1.469E-05, 2.932E-05, 4.388E-05, 5.833E-05, 7.258E-05, 8.648E-05, 9.964E-05, 1.111E-04, 1.193E-04, 1.243E-04, 1.304E-04, 1.418E-04, 1.622E-04, 1.824E-04, 2.005E-04, 2.174E-04, 2.336E-04, 2.494E-04, 7.919E-14, 1.447E-05, 2.890E-05, 4.325E-05, 5.749E-05, 7.154E-05, 8.525E-05, 9.824E-05, 1.096E-04, 1.177E-04, 1.226E-04, 1.287E-04, 1.401E-04, 1.603E-04, 1.802E-04, 1.979E-04, 2.145E-04, 2.305E-04, 2.460E-04, 7.805E-14, 1.427E-05, 2.849E-05, 4.264E-05, 5.668E-05, 7.053E-05, 8.405E-05, 9.687E-05, 1.081E-04, 1.162E-04, 1.210E-04, 1.271E-04, 1.384E-04, 1.585E-04, 1.779E-04, 1.954E-04, 2.117E-04, 2.274E-04, 2.427E-04, 7.696E-14, 1.407E-05, 2.809E-05, 4.204E-05, 5.588E-05, 6.955E-05, 8.289E-05, 9.555E-05, 1.066E-04, 1.146E-04, 1.195E-04, 1.255E-04, 1.368E-04, 1.566E-04, 1.758E-04, 1.929E-04, 2.090E-04, 2.244E-04, 2.395E-04, 7.589E-14, 1.387E-05, 2.770E-05, 4.146E-05, 5.511E-05, 6.860E-05, 8.176E-05, 9.426E-05, 1.052E-04, 1.131E-04, 1.179E-04, 1.239E-04, 1.352E-04, 1.548E-04, 1.736E-04, 1.905E-04, 2.063E-04, 2.215E-04, 2.364E-04, 7.485E-14, 1.368E-05, 2.732E-05, 4.089E-05, 5.437E-05, 6.767E-05, 8.066E-05, 9.300E-05, 1.038E-04, 1.117E-04, 1.164E-04, 1.224E-04, 1.337E-04, 1.531E-04, 1.716E-04, 1.882E-04, 2.037E-04, 2.187E-04, 2.333E-04, 7.384E-14, 1.350E-05, 2.695E-05, 4.034E-05, 5.364E-05, 6.677E-05, 7.959E-05, 9.178E-05, 1.025E-04, 1.103E-04, 1.150E-04, 1.209E-04, 1.322E-04, 1.514E-04, 1.695E-04, 1.859E-04, 2.012E-04, 2.159E-04, 2.304E-04, 7.285E-14, 1.332E-05, 2.659E-05, 3.981E-05, 5.293E-05, 6.589E-05, 7.855E-05, 9.059E-05, 1.012E-04, 1.089E-04, 1.136E-04, 1.194E-04, 1.307E-04, 1.497E-04, 1.676E-04, 1.836E-04, 1.987E-04, 2.132E-04, 2.275E-04, 7.189E-14, 1.314E-05, 2.624E-05, 3.929E-05, 5.224E-05, 6.503E-05, 7.753E-05, 8.943E-05, 9.993E-05, 1.076E-04, 1.122E-04, 1.180E-04, 1.293E-04, 1.481E-04, 1.656E-04, 1.814E-04, 1.963E-04, 2.106E-04, 2.246E-04, 7.096E-14, 1.297E-05, 2.590E-05, 3.878E-05, 5.156E-05, 6.419E-05, 7.654E-05, 8.830E-05, 9.868E-05, 1.063E-04, 1.109E-04, 1.166E-04, 1.279E-04, 1.465E-04, 1.637E-04, 1.793E-04, 1.939E-04, 2.081E-04, 2.219E-04, 7.005E-14, 1.280E-05, 2.557E-05, 3.828E-05, 5.091E-05, 6.338E-05, 7.558E-05, 8.720E-05, 9.747E-05, 1.050E-04, 1.095E-04, 1.153E-04, 1.266E-04, 1.449E-04, 1.619E-04, 1.772E-04, 1.916E-04, 2.056E-04, 2.192E-04, 6.916E-14, 1.264E-05, 2.525E-05, 3.780E-05, 5.027E-05, 6.259E-05, 7.464E-05, 8.613E-05, 9.629E-05, 1.037E-04, 1.083E-04, 1.140E-04, 1.252E-04, 1.434E-04, 1.601E-04, 1.751E-04, 1.894E-04, 2.031E-04, 2.166E-04, 6.830E-14, 1.249E-05, 2.493E-05, 3.733E-05, 4.964E-05, 6.181E-05, 7.372E-05, 8.508E-05, 9.514E-05, 1.025E-04, 1.070E-04, 1.127E-04, 1.240E-04, 1.419E-04, 1.583E-04, 1.731E-04, 1.872E-04, 2.007E-04, 2.140E-04, 6.746E-14, 1.233E-05, 2.463E-05, 3.687E-05, 4.903E-05, 6.106E-05, 7.283E-05, 8.405E-05, 9.401E-05, 1.013E-04, 1.058E-04, 1.114E-04, 1.227E-04, 1.404E-04, 1.566E-04, 1.712E-04, 1.850E-04, 1.984E-04, 2.115E-04, 6.663E-14, 1.218E-05, 2.433E-05, 3.642E-05, 4.844E-05, 6.032E-05, 7.195E-05, 8.306E-05, 9.291E-05, 1.002E-04, 1.046E-04, 1.102E-04, 1.215E-04, 1.390E-04, 1.549E-04, 1.693E-04, 1.829E-04, 1.961E-04, 2.091E-04, 6.583E-14, 1.203E-05, 2.404E-05, 3.599E-05, 4.786E-05, 5.960E-05, 7.110E-05, 8.208E-05, 9.184E-05, 9.903E-05, 1.034E-04, 1.090E-04, 1.203E-04, 1.375E-04, 1.532E-04, 1.674E-04, 1.809E-04, 1.939E-04, 2.067E-04, 6.505E-14, 1.189E-05, 2.375E-05, 3.556E-05, 4.729E-05, 5.890E-05, 7.027E-05, 8.113E-05, 9.079E-05, 9.792E-05, 1.023E-04, 1.079E-04, 1.191E-04, 1.361E-04, 1.516E-04, 1.656E-04, 1.789E-04, 1.917E-04, 2.043E-04, 6.428E-14, 1.175E-05, 2.347E-05, 3.514E-05, 4.674E-05, 5.821E-05, 6.945E-05, 8.020E-05, 8.976E-05, 9.684E-05, 1.012E-04, 1.067E-04, 1.179E-04, 1.348E-04, 1.500E-04, 1.638E-04, 1.769E-04, 1.896E-04, 2.021E-04, 6.353E-14, 1.161E-05, 2.320E-05, 3.474E-05, 4.620E-05, 5.754E-05, 6.866E-05, 7.929E-05, 8.876E-05, 9.578E-05, 1.001E-04, 1.056E-04, 1.168E-04, 1.334E-04, 1.484E-04, 1.620E-04, 1.750E-04, 1.875E-04, 1.998E-04, 6.280E-14, 1.148E-05, 2.293E-05, 3.434E-05, 4.567E-05, 5.689E-05, 6.788E-05, 7.840E-05, 8.778E-05, 9.475E-05, 9.903E-05, 1.045E-04, 1.157E-04, 1.321E-04, 1.469E-04, 1.603E-04, 1.731E-04, 1.855E-04, 1.976E-04, 6.209E-14, 1.135E-05, 2.267E-05, 3.395E-05, 4.516E-05, 5.625E-05, 6.712E-05, 7.753E-05, 8.682E-05, 9.373E-05, 9.799E-05, 1.034E-04, 1.146E-04, 1.308E-04, 1.454E-04, 1.587E-04, 1.713E-04, 1.835E-04, 1.955E-04, 6.139E-14, 1.122E-05, 2.242E-05, 3.357E-05, 4.465E-05, 5.562E-05, 6.638E-05, 7.668E-05, 8.588E-05, 9.274E-05, 9.697E-05, 1.024E-04, 1.135E-04, 1.296E-04, 1.439E-04, 1.570E-04, 1.695E-04, 1.815E-04, 1.934E-04, 6.071E-14, 1.111E-05, 2.217E-05, 3.320E-05, 4.416E-05, 5.501E-05, 6.565E-05, 7.585E-05, 8.497E-05, 9.177E-05, 9.597E-05, 1.014E-04, 1.125E-04, 1.283E-04, 1.425E-04, 1.554E-04, 1.677E-04, 1.796E-04, 1.914E-04, 6.004E-14, 1.099E-05, 2.193E-05, 3.284E-05, 4.368E-05, 5.441E-05, 6.494E-05, 7.503E-05, 8.407E-05, 9.082E-05, 9.499E-05, 1.004E-04, 1.115E-04, 1.271E-04, 1.411E-04, 1.538E-04, 1.660E-04, 1.778E-04, 1.893E-04, 5.939E-14, 1.087E-05, 2.169E-05, 3.248E-05, 4.321E-05, 5.383E-05, 6.424E-05, 7.423E-05, 8.319E-05, 8.989E-05, 9.404E-05, 9.938E-05, 1.105E-04, 1.259E-04, 1.397E-04, 1.523E-04, 1.643E-04, 1.759E-04, 1.874E-04, 5.875E-14, 1.075E-05, 2.146E-05, 3.213E-05, 4.275E-05, 5.325E-05, 6.356E-05, 7.345E-05, 8.233E-05, 8.898E-05, 9.310E-05, 9.842E-05, 1.095E-04, 1.247E-04, 1.383E-04, 1.508E-04, 1.626E-04, 1.741E-04, 1.855E-04, 5.813E-14, 1.064E-05, 2.123E-05, 3.179E-05, 4.229E-05, 5.269E-05, 6.290E-05, 7.269E-05, 8.148E-05, 8.809E-05, 9.218E-05, 9.748E-05, 1.085E-04, 1.236E-04, 1.370E-04, 1.493E-04, 1.610E-04, 1.724E-04, 1.836E-04, 5.752E-14, 1.053E-05, 2.101E-05, 3.146E-05, 4.185E-05, 5.214E-05, 6.224E-05, 7.194E-05, 8.066E-05, 8.721E-05, 9.128E-05, 9.656E-05, 1.076E-04, 1.225E-04, 1.357E-04, 1.478E-04, 1.594E-04, 1.707E-04, 1.817E-04, 5.692E-14, 1.042E-05, 2.079E-05, 3.113E-05, 4.142E-05, 5.160E-05, 6.161E-05, 7.121E-05, 7.985E-05, 8.635E-05, 9.040E-05, 9.566E-05, 1.066E-04, 1.213E-04, 1.344E-04, 1.464E-04, 1.578E-04, 1.690E-04, 1.799E-04, 5.633E-14, 1.031E-05, 2.057E-05, 3.081E-05, 4.099E-05, 5.108E-05, 6.098E-05, 7.049E-05, 7.905E-05, 8.551E-05, 8.954E-05, 9.477E-05, 1.057E-04, 1.202E-04, 1.331E-04, 1.450E-04, 1.563E-04, 1.673E-04, 1.781E-04, 5.575E-14, 1.020E-05, 2.036E-05, 3.050E-05, 4.058E-05, 5.056E-05, 6.037E-05, 6.979E-05, 7.828E-05, 8.469E-05, 8.869E-05, 9.390E-05, 1.048E-04, 1.192E-04, 1.319E-04, 1.436E-04, 1.548E-04, 1.657E-04, 1.764E-04, 5.519E-14, 1.010E-05, 2.016E-05, 3.019E-05, 4.017E-05, 5.005E-05, 5.976E-05, 6.910E-05, 7.751E-05, 8.388E-05, 8.786E-05, 9.305E-05, 1.039E-04, 1.181E-04, 1.307E-04, 1.422E-04, 1.533E-04, 1.641E-04, 1.747E-04, 5.464E-14, 9.999E-06, 1.996E-05, 2.989E-05, 3.977E-05, 4.956E-05, 5.917E-05, 6.842E-05, 7.677E-05, 8.309E-05, 8.704E-05, 9.221E-05, 1.031E-04, 1.171E-04, 1.295E-04, 1.409E-04, 1.519E-04, 1.625E-04, 1.730E-04, 5.410E-14, 9.900E-06, 1.976E-05, 2.960E-05, 3.938E-05, 4.907E-05, 5.860E-05, 6.776E-05, 7.603E-05, 8.231E-05, 8.624E-05, 9.139E-05, 1.022E-04, 1.162E-04, 1.283E-04, 1.396E-04, 1.504E-04, 1.610E-04, 1.714E-04]).reshape((100, 19))
    powmux_f = interpolate.interp2d( ys, xs, zz)
    
    # Get the design spec & parameters from spec file
    try:
        Iload = float(jsonSpec['specifications']['Iload (mA)'])
    except KeyError as e:
        print('Error: Bad Input Specfile. \'Iload (mA)\' value is missing under \'specifications\'.')
        sys.exit(1)
    except ValueError as e:
        print('Error: Bad Input Specfile. Please use a float value for \'Iload (mA)\' under \'specifications\'.')
        sys.exit(1)
    if Iload > 10.0 or Iload < 0.1:
        print('Error: Only support Iload from 0.1 ~ 10 now')
        sys.exit(1)

    try:
        Frequency = float(jsonSpec['specifications']['Clock frequency (kHz)'])
    except KeyError as e:
        print('Error: Bad Input Specfile. \'Clock frequency (kHz)\' value is missing under \'specifications\'.')
        sys.exit(1)
    except ValueError as e:
        print('Error: Bad Input Specfile. Please use a float value for \'Clock frequency (kHz)\' under \'specifications\'.')
        sys.exit(1)
	
    
    designName = jsonSpec['module_name']
    
    SupplyVolt = platformConfig['platforms'][args.platform]['nominal_voltage']
        
    print('\n\n<DCDC Spec>')
    print('DCDC Instance Name - \"' + designName + '\"')
    print('Supply Voltage - \"' + str(SupplyVolt) + '\"')
    print('Iload(mA) - \"' + str(Iload) + '\"')
    print('Frequency (kHz) - \"' + str(Frequency) + '\"')    
    
    
    # process 2:1 stage switch and cap configuration
    # Technology parameter ######
    if re.search('sky130',args.platform): 
        k_sqrt_rc = 6.1E-6
        deltaV  = 0.10
        unit_cap_capacitance = 0.27588E-12
        unit_r_resistance = 6750
    #############################

    # Determine the cap and switch size
    dcdc_cap_size = int((Iload * 0.001) / (2 * deltaV * Frequency * 1000) / 2 / unit_cap_capacitance)
    if dcdc_cap_size == 0:
        dcdc_cap_size = 1

    dcdc_sw_size = int(unit_r_resistance / (k_sqrt_rc * SupplyVolt * math.sqrt(Frequency * 1000) / (Iload * 0.001)))
    if dcdc_sw_size == 0:
        dcdc_sw_size = 1

    # Determine Offset_y
    # offset_y = 50 * int(dcdc_sw_size / (1<<(dcdc_num_stage-1)))       # Eventually will need this to tune the APR settings
    # if offset_y == 0:
        # offset_y = 50

    # Determine power mux configuration
    num_stages = 6
    powmux_config = []
    
    for stage in range(0, num_stages):
        Iout_stage = (Iload * 0.001) * pow(2, -(num_stages - (stage + 1)))
        
        # for voltage, assuming 1/2 vdd for all stages for now
        Vout_stage = 1/2 * SupplyVolt
        
        # calculated load = V/I
        Rout_stage = Vout_stage / Iout_stage
        
        # single powmux drive
        unit_powmux_current = powmux_f(Vout_stage, Rout_stage)
        
        # calculate number of parallel muxes
        num_mux = int(math.ceil(Iout_stage / unit_powmux_current)) 
        
        powmux_config.append(num_mux) 
    
    powmux_config = ["8'd" + str(cfg) for cfg in powmux_config]
    
    print('\n\n<DCDC Configuration>')
    print('dcdc_cap_size: ' + str(dcdc_cap_size))
    print('dcdc_sw_size: ' + str(dcdc_sw_size))
    print('pow_mux_config: ' + ','.join(powmux_config) + '\n\n')

    # process 6-stage conv verilog
    with open(srcDir + '/DCDC_SIX_STAGES_CONV.template.v', 'r') as file:
        filedata = file.read()
        filedata = re.sub(r'(?<=DCDC_CAP_SIZE = ).+(?=;)', str(dcdc_cap_size), filedata)
        filedata = re.sub(r'(?<=DCDC_SW_SIZE = ).+(?=;)', str(dcdc_sw_size), filedata)
        filedata = re.sub(r'(?<=DCDC_PWR_MUX_CONF = ).+(?=;)', '{' + ','.join(powmux_config) + '}', filedata)

    with open(srcDir + '/DCDC_SIX_STAGES_CONV.v', 'w') as file:
        file.write(filedata)

    # process the top level verilog
    r_netlist=open(srcDir + "/dcdcInst.template.v","r")
    lines=list(r_netlist.readlines())
    w_netlist=open(srcDir + "/dcdcInst.v","w")

    netmap_top=function.netmap()
    netmap_top.get_net('na',cells['ff_cell'],1,1,1)
    netmap_top.get_net('nb',cells['inv_cell'],1,1,1)
    netmap_top.get_net('nc',cells['clkgate_cell'],1,1,1)
	
    for line in lines:
        netmap_top.printline(line,w_netlist)

    # process the non-inverting clock verilog
    r_netlist=open(srcDir + "/DCDC_NOV_CLKGEN.template.sv","r")
    lines=list(r_netlist.readlines())
    w_netlist=open(srcDir + "/DCDC_NOV_CLKGEN.sv","w")

    netmap_novclkgen=function.netmap()
    netmap_novclkgen.get_net('na',cells['nand2_cell'],1,1,1)
    netmap_novclkgen.get_net('nb',cells['clkinv_cell'],1,1,1)
    netmap_novclkgen.get_net('nc',cells['clkinv_cell'],1,1,1)
    netmap_novclkgen.get_net('ne',cells['clkinv_cell'],1,1,1)
    netmap_novclkgen.get_net('nf',cells['clkinv_cell'],1,1,1)
    netmap_novclkgen.get_net('nd',cells['nor2_cell'],1,1,1)
	
    for line in lines:
        netmap_novclkgen.printline(line,w_netlist)
        
    
    netmap_buffer=function.netmap()
    netmap_buffer.get_net('nb',cells['clkinv_cell'],1,1,1)
    netmap_buffer.get_net('nc',cells['clkinv_cell'],1,1,1)
    
    r_netlist=open(srcDir + "/DCDC_BUFFER.template.sv","r")
    lines=list(r_netlist.readlines())
    w_netlist=open(srcDir + "/DCDC_BUFFER.sv","w")
	
    for line in lines:
        netmap_buffer.printline(line,w_netlist)
    
    # process the power mux verilog
    r_netlist=open(srcDir + "/DCDC_POWMUX.template.v","r")
    lines=list(r_netlist.readlines())
    w_netlist=open(srcDir + "/DCDC_POWMUX.v","w")

    netmap_powmux=function.netmap()
    #netmap_powmux.get_net('na',cells['inv_cell_w'],1,1,1)
    #netmap_powmux.get_net('nb',cells['inv_cell_w'],1,1,1)
	
    for line in lines:
        netmap_powmux.printline(line,w_netlist)
        
    return

